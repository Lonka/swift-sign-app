import{a as R}from"./index-8dba5944.js";import{d as q,k as p,p as L,r as Q,o as Z,c as j,e as a,b as A,f as x,q as G,t as Y,F as J}from"./index-7d73666b.js";const k=(v,l)=>(v+l)/2;function C(v,l=!0){const o=v.length;if(o<4)return"";let t=v[0],n=v[1];const h=v[2];let d=`M${t[0].toFixed(2)},${t[1].toFixed(2)} Q${n[0].toFixed(2)},${n[1].toFixed(2)} ${k(n[0],h[0]).toFixed(2)},${k(n[1],h[1]).toFixed(2)} T`;for(let f=2,u=o-1;f<u;f++)t=v[f],n=v[f+1],d+=`${k(t[0],n[0]).toFixed(2)},${k(t[1],n[1]).toFixed(2)} `;return l&&(d+="Z"),d}const K=a("div",{class:"i-carbon-volume-file-storage h-6 w-6"},null,-1),ee=[K],te=a("div",{class:"i-carbon-save h-6 w-6"},null,-1),ne=[te],oe=a("div",{class:"i-carbon-trash-can h-6 w-6"},null,-1),ie=[oe],ae=a("div",{class:"i-carbon-pen h-6 w-6"},null,-1),le=[ae],se=a("div",{class:"i-carbon-pen-fountain h-6 w-6"},null,-1),re=[se],ce={class:"inline-block mx-2 !outline-none"},ue=a("div",{class:"i-carbon-document-signed h-6 w-6"},null,-1),fe=[ue],he=a("div",{class:"i-carbon-clean h-6 w-6"},null,-1),ve=[he],de={class:"border border-dark-500 relative"},g=2,_e=q({__name:"drawBoard",setup(v){const l=p(),o=p();let t=null,n=null;const h=p(0);let d=!1;const f=p([]),u=[],b=p(void 0),m=p("Black"),s=p(),_=p(),y=[];L(()=>{var e,i;t=(e=l.value)==null?void 0:e.getContext("2d"),l.value&&t&&(l.value.width=window.innerWidth-60,l.value.height=window.innerHeight-200,t.fillStyle="rgba(255,255,255)",t.fillRect(0,0,l.value.width,l.value.height)),n=(i=o.value)==null?void 0:i.getContext("2d"),o.value&&n&&(o.value.width=window.innerWidth-60,o.value.height=window.innerHeight-200,n.fillStyle="rgba(255,255,255,0)",n.fillRect(0,0,o.value.width,o.value.height)),b.value={size:13,smoothing:.5,thinning:.5,streamline:.5,easing:r=>1-Math.cos(r*Math.PI/2),start:{taper:0,cap:!0},end:{taper:1,cap:!0}}});const I=e=>{o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height);const i=R(e.points,e.options),r=C(i),c=new Path2D(r);n==null||n.fill(c)},$=e=>{o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height),s.value&&(n==null||n.strokeRect(s.value.x,s.value.y,e.x-s.value.x,e.y-s.value.y))},B=()=>{if(u.length>0){o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height);const e=u[u.length-1],i=C(R(e.points,e.options)),r=new Path2D(i);e.penColor&&(t.fillStyle=e.penColor.toString()),t==null||t.fill(r)}},O=()=>{if(_.value&&s.value){o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height);const e=new Image;e.onload=()=>{_.value&&s.value&&(t==null||t.drawImage(e,s.value.x,s.value.y,_.value.x-s.value.x,_.value.y-s.value.y),y.push({image:e,initialPoint:Object.assign({},s.value),finishPoint:Object.assign({},_.value)}))},e.crossOrigin="anonymous",e.src="/swift-sign-app/signature.png"}},T=()=>{h.value=0,b.value={size:16,smoothing:.5,thinning:.5,streamline:.5,easing:e=>e,start:{taper:0,cap:!0},end:{taper:0,cap:!0}}},E=()=>{h.value=1,b.value={size:13,smoothing:.5,thinning:.5,streamline:.5,easing:e=>1-Math.cos(e*Math.PI/2),start:{taper:0,cap:!0},end:{taper:1,cap:!0}}},z=()=>{h.value=2},H=()=>{h.value=3},D=()=>{t&&l.value&&(t.clearRect(0,0,l.value.width,l.value.height),t.fillStyle="rgba(255,255,255)",t.fillRect(0,0,l.value.width,l.value.height))},F=()=>{u.forEach(e=>{const i=C(R(e.points,e.options)),r=new Path2D(i);e.penColor&&(t.fillStyle=e.penColor.toString()),t==null||t.fill(r)}),y.forEach(e=>t==null?void 0:t.drawImage(e.image,e.initialPoint.x,e.initialPoint.y,e.finishPoint.x-e.initialPoint.x,e.finishPoint.y-e.initialPoint.y))},N=()=>{},M=e=>{if(e.preventDefault(),d=!0,o.value&&n)switch(h.value){case 0:case 1:f.value.length=0,n.fillStyle=m.value.toString(),f.value.push({x:e.offsetX,y:e.offsetY,p:e.pressure}),u.push({options:Object.assign({},b.value),points:[{x:e.offsetX,y:e.offsetY,p:e.pressure}],penColor:m.value});break;case 3:s.value={x:e.offsetX,y:e.offsetY};break}},U=e=>{let i=-1,r=!1;if(d&&e.buttons===1)switch(e.preventDefault(),h.value){case 0:case 1:f.value.push({x:e.offsetX,y:e.offsetY,p:e.pressure}),u[u.length-1].points.push({x:e.offsetX,y:e.offsetY,p:e.pressure}),I({points:f.value,options:b.value});break;case 3:_.value={x:e.offsetX,y:e.offsetY},$(_.value);break;case 2:for(let c=0;c<u.length;c++){const w=u[c];for(let S=0;S<w.points.length;S++){const P=w.points[S];if(P.x+g>=e.offsetX&&P.x-g<=e.offsetX&&P.y+g>=e.offsetY&&P.y-g<=e.offsetY){i=c;break}}if(i>-1)break}i>-1&&(u.splice(i,1),r=!0),i=-1;for(let c=0;c<y.length;c++){const w=y[c];if(w.initialPoint.x-g<=e.offsetX&&w.finishPoint.x+g>=e.offsetX&&w.initialPoint.y-g<=e.offsetY&&w.initialPoint.y+g>=e.offsetY){i=c;break}}i>-1&&(y.splice(i,1),r=!0),i=-1,r&&(D(),F());break}},X=e=>{switch(e.preventDefault(),d=!1,h.value){case 0:case 1:B();break;case 3:O();break}},V=e=>{e.buttons===1&&M(e)},W=e=>{d&&X(e)};return(e,i)=>{const r=Q("color-picker");return Z(),j(J,null,[a("div",null,[a("div",{class:"icon-btn mx-2 !outline-none",onClick:F},ee),a("div",{class:"icon-btn mx-2 !outline-none",onClick:N},ne),a("div",{class:"icon-btn mx-2 !outline-none",onClick:D},ie),a("div",{class:"icon-btn mx-2 !outline-none",onClick:T},le),a("div",{class:"icon-btn mx-2 !outline-none",onClick:E},re),a("div",ce,[A(r,{pureColor:x(m),"onUpdate:pureColor":i[0]||(i[0]=c=>G(m)?m.value=c:null),class:"w-6"},null,8,["pureColor"])]),a("div",{class:"icon-btn mx-2 !outline-none",onClick:H},fe),a("div",{class:"icon-btn mx-2 !outline-none",onClick:z},ve)]),a("p",null,Y(x(m)),1),a("p",null,Y(x(f)[x(f).length-1]),1),a("div",de,[a("canvas",{ref_key:"canvasDraftRef",ref:o,style:{"touch-action":"none","user-select":"none"},class:"absolute",onPointerdown:M,onPointermove:U,onPointerup:X,onPointerenter:V,onPointerleave:W},null,544),a("canvas",{ref_key:"canvasRef",ref:l},null,512)])],64)}}});export{_e as default};
