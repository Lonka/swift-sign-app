import{P as w}from"./index-8dba5944.js";import{d as v,i as I,j as C,o as D,c as E,e as l,b as O,f as b,F as x}from"./index-e3db0870.js";var y=Object.defineProperty,S=Object.defineProperties,R=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,d=(t,n,e)=>n in t?y(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,s=(t,n)=>{for(var e in n||(n={}))P.call(n,e)&&d(t,e,n[e]);if(c)for(var e of c(n))m.call(n,e)&&d(t,e,n[e]);return t},B=(t,n)=>S(t,R(n)),U=(t,n)=>{var e={};for(var r in t)P.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&c)for(var r of c(t))n.indexOf(r)<0&&m.call(t,r)&&(e[r]=t[r]);return e},A=t=>t?Object.entries(t).reduce((n,[e,r])=>(e=e.charAt(0).toUpperCase()+e.slice(1),e=`on${e}`,B(s({},n),{[e]:r})),{}):null,L=(t,n={},e)=>{const r=n,{props:o,domProps:i,on:a}=r,u=U(r,["props","domProps","on"]),h=A(a),_=s(s(s(s({},u),o),i),h);return I(t,_,e)},j=L;function p(t){if(!t.length)return"";const n=t.reduce((e,[r,o],i,a)=>{const[u,h]=a[(i+1)%a.length];return e.push(r,o,(r+u)/2,(o+h)/2),e},["M",...t[0],"Q"]);return n.push("Z"),n.join(" ")}var k="rgba(0,0,0,0)",T="#000",F="100%",$="100%",g=["image/png","image/jpeg","image/svg+xml"],{getStroke:f}=w,H=v({props:{width:{type:String,required:!1,default:F},height:{type:String,required:!1,default:$},backgroundColor:{type:String,required:!1,default:k},penColor:{type:String,required:!1,default:T},strokeOptions:{type:Object,required:!1,default:()=>({})}},emits:["onBegin","onEnd"],data:()=>({allInputPoints:[],currentInputPoints:null,isDrawing:!1,cachedImages:[]}),watch:{backgroundColor(){this.setBackgroundAndPenColor()},penColor(t){const e=this.getCanvasElement().getContext("2d");e&&(e.fillStyle=t)},allInputPoints:{deep:!0,handler(){this.inputPointsHandler()}},currentInputPoints:{deep:!0,handler(){this.inputPointsHandler()}}},mounted(){this.resizeCanvas()},methods:{handlePointerDown(t){t.preventDefault();const e=t.composedPath()[0].getBoundingClientRect(),r=t.clientX-e.left,o=t.clientY-e.top;this.currentInputPoints=[[r,o,t.pressure]],this.isDrawing=!0,this.$emit("onBegin",t)},handlePointerMove(t){var n;if(this.isDrawing&&t.buttons===1){t.preventDefault();const r=t.composedPath()[0].getBoundingClientRect(),o=t.clientX-r.left,i=t.clientY-r.top;this.currentInputPoints=[...(n=this.currentInputPoints)!=null?n:[],[o,i,t.pressure]]}},handlePointerUp(t){t.preventDefault(),this.isDrawing=!1,this.currentInputPoints&&(this.allInputPoints=[...this.allInputPoints,this.currentInputPoints],this.currentInputPoints=null,this.$emit("onEnd",t))},handlePointerEnter(t){t.buttons===1&&this.handlePointerDown(t)},handlePointerLeave(t){this.isDrawing&&this.handlePointerUp(t)},isEmpty(){return!this.allInputPoints.length&&!this.cachedImages.length},clear(){this.cachedImages=[],this.allInputPoints=[],this.currentInputPoints=null},fromData(t){this.allInputPoints=[...this.allInputPoints,...t]},toData(){return this.allInputPoints},fromDataURL(t){return new Promise((n,e)=>{const r=new Image;r.onload=()=>{const o=this.getCanvasElement(),i=o.getContext("2d");i==null||i.drawImage(r,0,0,o.width,o.height),this.cachedImages.push(r),n(!0)},r.onerror=()=>{e(new Error("Incorrect data uri provided"))},r.crossOrigin="anonymous",r.src=t})},toDataURL(t){if(t&&!g.includes(t))throw new Error(`Incorrect image type. Must be one of ${g.join(", ")}.`);return this.isEmpty()?void 0:this.getCanvasElement().toDataURL(t??"image/png")},getCanvasElement(){return this.$refs.signaturePad},setBackgroundAndPenColor(){const t=this.getCanvasElement(),n=t.getContext("2d");n.fillStyle=this.backgroundColor,n==null||n.fillRect(0,0,t.width,t.height),n.fillStyle=this.penColor},resizeCanvas(t=!0){const n=this.getCanvasElement(),e=n.getBoundingClientRect(),r=window.devicePixelRatio||1;n.width=e.width*r,n.height=e.height*r;const o=n.getContext("2d");o==null||o.scale(r,r),n.style.width=`${e.width}px`,n.style.height=`${e.height}px`,t&&this.clear(),this.setBackgroundAndPenColor()},inputPointsHandler(){const t=this.getCanvasElement(),n=t.getContext("2d");if(n==null||n.clearRect(0,0,t.width,t.height),this.cachedImages.forEach(o=>n==null?void 0:n.drawImage(o,0,0,t.width,t.height)),this.setBackgroundAndPenColor(),this.allInputPoints.forEach(o=>{const i=p(f(o,this.strokeOptions)),a=new Path2D(i);n==null||n.fill(a)}),!this.currentInputPoints)return;const e=p(f(this.currentInputPoints,this.strokeOptions)),r=new Path2D(e);n==null||n.fill(r)}},render(){const{width:t,height:n}=this,e={pointerdown:this.handlePointerDown,pointerup:this.handlePointerUp,pointermove:this.handlePointerMove,pointerenter:this.handlePointerEnter,pointerleave:this.handlePointerLeave};return j("canvas",{ref:"signaturePad",style:{height:n,width:t,touchAction:"none"},on:e})}});const M=l("div",{"i-carbon-save":""},null,-1),q=[M],N=l("div",{"i-carbon-pen":""},null,-1),V=[N],z="rgba(252,211,77,0.5)",X=v({__name:"vPerfectSignature",setup(t){const n=C(),e={size:16,thinning:.75,smoothing:.5,streamline:.5},r=()=>{};function o(){const i=n.value.toData();n.value.clear(),setTimeout(()=>{n.value.fromData(i)},3e3)}return(i,a)=>(D(),E(x,null,[l("button",{class:"icon-btn mx-2 !outline-none cursor-pointer",onClick:o},q),l("button",{class:"icon-btn mx-2 !outline-none cursor-pointer",onClick:r},V),O(b(H),{ref_key:"signaturePad",ref:n,"pen-color":z,"stroke-options":e},null,512)],64))}});export{X as default};
