import{a as S}from"./index-8dba5944.js";import{d as j,j as p,m as L,r as Q,o as Z,c as q,e as l,b as A,f as C,n as G,t as $,F as J}from"./index-a91cb19d.js";const x=(h,a)=>(h+a)/2;function R(h,a=!0){const o=h.length;if(o<4)return"";let t=h[0],n=h[1];const u=h[2];let d=`M${t[0].toFixed(2)},${t[1].toFixed(2)} Q${n[0].toFixed(2)},${n[1].toFixed(2)} ${x(n[0],u[0]).toFixed(2)},${x(n[1],u[1]).toFixed(2)} T`;for(let v=2,r=o-1;v<r;v++)t=h[v],n=h[v+1],d+=`${x(t[0],n[0]).toFixed(2)},${x(t[1],n[1]).toFixed(2)} `;return a&&(d+="Z"),d}const K=l("div",{class:"i-carbon-volume-file-storage h-6 w-6"},null,-1),ee=[K],ne=l("div",{class:"i-carbon-save h-6 w-6"},null,-1),te=[ne],oe=l("div",{class:"i-carbon-trash-can h-6 w-6"},null,-1),ie=[oe],le=l("div",{class:"i-carbon-pen h-6 w-6"},null,-1),ae=[le],se=l("div",{class:"i-carbon-pen-fountain h-6 w-6"},null,-1),ce=[se],re={class:"inline-block mx-2 !outline-none"},ue=l("div",{class:"i-carbon-document-signed h-6 w-6"},null,-1),fe=[ue],he=l("div",{class:"i-carbon-clean h-6 w-6"},null,-1),ve=[he],de={class:"border border-dark-500 relative"},g=2,_e=j({__name:"freehand",setup(h){const a=p(),o=p();let t=null,n=null;const u=p(0);let d=!1;const v=p([]),r=[],y=p(void 0),m=p("Black"),s=p(),_=p(),b=[];L(()=>{var e,i;t=(e=a.value)==null?void 0:e.getContext("2d"),a.value&&t&&(a.value.width=window.innerWidth,a.value.height=window.innerHeight-60,t.fillStyle="rgba(255,255,255)",t.fillRect(0,0,a.value.width,a.value.height)),n=(i=o.value)==null?void 0:i.getContext("2d"),o.value&&n&&(o.value.width=window.innerWidth,o.value.height=window.innerHeight-60,n.fillStyle="rgba(255,255,255,0)",n.fillRect(0,0,o.value.width,o.value.height))});const I=e=>{o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height);const i=S(e.points,e.options),f=R(i),c=new Path2D(f);n==null||n.fill(c)},M=e=>{o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height),s.value&&(n==null||n.strokeRect(s.value.x,s.value.y,e.x-s.value.x,e.y-s.value.y))},O=()=>{if(r.length>0){o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height);const e=r[r.length-1],i=R(S(e.points,e.options)),f=new Path2D(i);e.penColor&&(t.fillStyle=e.penColor.toString()),t==null||t.fill(f)}},T=()=>{if(_.value&&s.value){o.value&&n&&n.clearRect(0,0,o.value.width,o.value.height);const e=new Image;e.onload=()=>{_.value&&s.value&&(t==null||t.drawImage(e,s.value.x,s.value.y,_.value.x-s.value.x,_.value.y-s.value.y),b.push({image:e,initialPoint:Object.assign({},s.value),finishPoint:Object.assign({},_.value)}))},e.crossOrigin="anonymous",e.src="/signature.png"}},E=()=>{u.value=0,y.value={size:8,thinning:.5,streamline:.5,smoothing:.5,last:!0}},B=()=>{u.value=1,y.value={size:16,smoothing:.5,thinning:.5,streamline:.5,easing:e=>e,start:{taper:0,cap:!0},end:{taper:0,cap:!0}}},z=()=>{u.value=2},H=()=>{u.value=3},D=()=>{t&&a.value&&t.clearRect(0,0,a.value.width,a.value.height)},F=()=>{r.forEach(e=>{const i=R(S(e.points,e.options)),f=new Path2D(i);e.penColor&&(t.fillStyle=e.penColor.toString()),t==null||t.fill(f)}),b.forEach(e=>t==null?void 0:t.drawImage(e.image,e.initialPoint.x,e.initialPoint.y,e.finishPoint.x-e.initialPoint.x,e.finishPoint.y-e.initialPoint.y))},N=()=>{},X=e=>{if(e.preventDefault(),d=!0,o.value&&n)switch(u.value){case 0:case 1:v.value.length=0,n.fillStyle=m.value.toString(),v.value.push({x:e.offsetX,y:e.offsetY,p:e.pressure}),r.push({options:Object.assign({},y.value),points:[{x:e.offsetX,y:e.offsetY,p:e.pressure}],penColor:m.value});break;case 3:s.value={x:e.offsetX,y:e.offsetY};break}},U=e=>{let i=-1,f=!1;if(d&&e.buttons===1)switch(e.preventDefault(),u.value){case 0:case 1:v.value.push({x:e.offsetX,y:e.offsetY,p:e.pressure}),r[r.length-1].points.push({x:e.offsetX,y:e.offsetY,p:e.pressure}),I({points:v.value,options:y.value});break;case 3:_.value={x:e.offsetX,y:e.offsetY},M(_.value);break;case 2:for(let c=0;c<r.length;c++){const w=r[c];for(let k=0;k<w.points.length;k++){const P=w.points[k];if(P.x+g>=e.offsetX&&P.x-g<=e.offsetX&&P.y+g>=e.offsetY&&P.y-g<=e.offsetY){i=c;break}}if(i>-1)break}i>-1&&(r.splice(i,1),f=!0),i=-1;for(let c=0;c<b.length;c++){const w=b[c];if(w.initialPoint.x-g<=e.offsetX&&w.finishPoint.x+g>=e.offsetX&&w.initialPoint.y-g<=e.offsetY&&w.initialPoint.y+g>=e.offsetY){i=c;break}}i>-1&&(b.splice(i,1),f=!0),i=-1,f&&(D(),F());break}},Y=e=>{switch(e.preventDefault(),d=!1,u.value){case 0:case 1:O();break;case 3:T();break}},V=e=>{e.buttons===1&&X(e)},W=e=>{d&&Y(e)};return(e,i)=>{const f=Q("color-picker");return Z(),q(J,null,[l("div",null,[l("div",{class:"icon-btn mx-2 !outline-none",onClick:F},ee),l("div",{class:"icon-btn mx-2 !outline-none",onClick:N},te),l("div",{class:"icon-btn mx-2 !outline-none",onClick:D},ie),l("div",{class:"icon-btn mx-2 !outline-none",onClick:E},ae),l("div",{class:"icon-btn mx-2 !outline-none",onClick:B},ce),l("div",re,[A(f,{pureColor:C(m),"onUpdate:pureColor":i[0]||(i[0]=c=>G(m)?m.value=c:null),class:"w-6"},null,8,["pureColor"])]),l("div",{class:"icon-btn mx-2 !outline-none",onClick:H},fe),l("div",{class:"icon-btn mx-2 !outline-none",onClick:z},ve)]),l("p",null,$(C(m)),1),l("p",null,$(C(u)),1),l("div",de,[l("canvas",{ref_key:"canvasDraftRef",ref:o,class:"absolute",onPointerdown:X,onPointermove:U,onPointerup:Y,onPointerenter:V,onPointerleave:W},null,544),l("canvas",{ref_key:"canvasRef",ref:a},null,512)])],64)}}});export{_e as default};
